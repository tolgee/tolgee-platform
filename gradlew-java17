#!/bin/bash

# Check if JAVA_HOME_17 is set
if [ -n "$JAVA_HOME_17" ]; then
    export JAVA_HOME="$JAVA_HOME_17"
else
    # Try to find Java 17 in common macOS installation locations
    for dir in \
        "/Library/Java/JavaVirtualMachines/jdk-17"* \
        "/Library/Java/JavaVirtualMachines/temurin-17"* \
        "/Library/Java/JavaVirtualMachines/adoptopenjdk-17"* \
        "/opt/homebrew/opt/openjdk@17" \
        "$HOME/.sdkman/candidates/java/"*"17"*
    do
        if [ -d "$dir" ]; then
            if [ -d "$dir/Contents/Home" ]; then
                # macOS path
                export JAVA_HOME="$dir/Contents/Home"
            else
                # Linux path
                export JAVA_HOME="$dir"
            fi
            break
        fi
    done
fi

if [ -z "$JAVA_HOME" ]; then
    echo "Java 17 not found. Please install Java 17 or set JAVA_HOME_17 environment variable."
    echo "You can install Java 17 with Homebrew: brew install openjdk@17"
    exit 1
fi

echo "Using Java 17 from $JAVA_HOME"
chmod +x ./backend/gradlew
./backend/gradlew "$@" 